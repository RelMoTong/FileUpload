# Version 3.2.0 - 文件清理功能重大升级

## 🎉 发布日期
2025年12月17日

## 📦 更新内容

### 核心功能升级

#### 1. 结果区域全面改版 🎨
- **从日志框升级为交互式表格**
  - 显示：复选框、文件名、完整路径、文件大小、修改时间
  - 支持点击列标题排序（按大小、时间、名称等）
  - 默认全选，可逐个取消勾选不需要删除的文件
  - 提供"全选"和"取消全选"快捷按钮

#### 2. 实时搜索和过滤 🔍
- 搜索框支持实时过滤文件列表
- 同时匹配文件名和路径
- 不区分大小写
- 隐藏不匹配的行，保持界面整洁

#### 3. 右键菜单功能 🖱️
- **打开所在文件夹**：在系统文件管理器中定位文件
  - Windows：使用 `explorer /select,`
  - macOS：使用 `open -R`
  - Linux：使用 `xdg-open` 打开目录
- **复制路径**：复制完整文件路径到剪贴板
- **复制文件名**：仅复制文件名到剪贴板

#### 4. 可取消的扫描 + 实时进度 ⏸️
- **新增"取消扫描"按钮**，随时中止长时间扫描
- **实时进度显示**：
  - 当前正在扫描的目录
  - 已发现的文件数量
  - 累计文件大小（MB）
- 进度信息每次进入新目录时更新

#### 5. 删除前清单摘要 📋
- 显示 **Top 5 最大文件** 及其大小
- 明确显示操作类型："移入回收站" 或 "永久删除"
- 清晰的确认对话框，包含：
  - 文件清单摘要
  - 总文件数和总大小（MB 和 GB）
  - 安全提示（回收站可恢复 vs 永久删除警告）

#### 6. 安全默认设置 🛡️
- **自动检测** `send2trash` 模块可用性
- **默认勾选"移入回收站"**（如果模块可用）
- **前置警告**：如果未安装模块，顶部显示红色警告横幅
- 避免用户在删除阶段才发现无法使用回收站

#### 7. 过滤条件：按修改时间 📅
- 新增"过滤条件"区域
- 复选框："仅显示/删除 N 天前的文件"
- 支持设置 1-365 天
- 扫描时自动过滤，仅包含指定天数前的文件
- 帮助聚焦旧文件，避免误删新文件

#### 8. 智能复选框联动 🔗
- **监控文件夹**：勾选后才启用输入框和"浏览"按钮
- **自定义文件夹**：勾选后才启用输入框和"浏览"按钮
- 未勾选时控件禁用（灰色），避免用户误以为输入会生效

#### 9. 布局体验优化 📐
- **可调整大小**：最小 1000x700，默认 1200x800
- **QSplitter 分隔**：选项区和结果区可调整比例
- **结果区占主要空间**：默认比例 1:2
- **选项区可滚动**：使用 QScrollArea，适应小屏幕
- **自动清理配置可折叠**：使用 CollapsibleBox，节省空间

#### 10. 文案和定位优化 💬
- 窗口标题：**"文件清理工具 - 按目录和扩展名清理"**
- 副标题：**"按目录和扩展名清理文件（非系统级磁盘清理）"**
- 避免用户误解为 Windows"磁盘清理"功能
- 明确说明工具定位和适用场景

---

## 🔧 技术改进

### 新增数据结构
```python
class FileItem:
    path: str       # 完整路径
    size: int       # 文件大小（字节）
    mtime: float    # 修改时间戳
    name: str       # 文件名
    checked: bool   # 是否勾选
```

### 新增组件
- **FileListTable**：文件列表表格组件
  - 排序、搜索、右键菜单
  - 复选框管理
  - 获取已勾选文件

### 信号优化
- `ScanWorker.progress_detail(str, int, int)`：实时进度信号
- `ScanWorker.finished(List[FileItem])`：返回结构化数据
- `ScanWorker.cancel()`：取消扫描方法

---

## 📚 新增文档

1. **docs/CLEANUP_UPGRADE.md** - 详细升级说明
   - 功能对比
   - 技术实现细节
   - 使用体验对比

2. **docs/CLEANUP_QUICKSTART.md** - 快速入门指南
   - 7 步使用流程
   - 常见问题解答
   - 最佳实践示例

3. **docs/CLEANUP_SUMMARY.md** - 升级总结
   - 核心改进
   - 架构变化
   - 设计原则

---

## 🎯 适用场景

- ✅ 定期清理备份目录中的旧文件
- ✅ 批量删除特定格式文件（图片、日志等）
- ✅ 按修改时间清理临时文件
- ✅ 查找和删除最大的文件以释放空间
- ✅ 安全清理（回收站模式）或彻底删除

---

## 🔄 兼容性

- ✅ 完全兼容 PySide6 和 PyQt5
- ✅ 支持 Windows / macOS / Linux
- ✅ 向后兼容所有原有功能
- ✅ 不影响主窗口的自动清理配置

---

## 🚀 安装和使用

### 推荐安装（支持回收站）
```bash
pip install send2trash
```

### 启动程序
```bash
python src/main.py
```

### 打开清理工具
主窗口 → 菜单 → 工具 → 文件清理

---

## 📝 重要提示

1. **首次使用建议**
   - 先在测试目录试用
   - 仔细检查扫描结果
   - 取消勾选重要文件

2. **安全建议**
   - 安装 send2trash 使用回收站模式
   - 重要数据先备份
   - 使用过滤条件避免误删新文件

3. **性能建议**
   - 单次扫描建议不超过 10 万个文件
   - 大量文件时建议分批处理
   - 可随时取消长时间扫描

---

## 🐛 已知问题

无重大问题。

---

## 🙏 致谢

感谢所有测试用户的反馈和建议！

---

## 📧 反馈和支持

如有问题或建议，请提交 Issue 或 Pull Request。

---

**享受全新的文件清理体验！** 🎉
