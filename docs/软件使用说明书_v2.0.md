# 图片异步上传工具 - 使用说明书 v2.0

## 📘 目录
1. [软件简介](#软件简介)
2. [系统要求](#系统要求)
3. [安装与启动](#安装与启动)
4. [界面说明](#界面说明)
5. [快速开始](#快速开始)
6. [功能详解](#功能详解)
7. [权限系统](#权限系统)
8. [高级功能](#高级功能)
9. [常见问题](#常见问题)
10. [注意事项](#注意事项)

---

## 📖 软件简介

**图片异步上传工具**是一款专业的图片文件管理工具，用于自动监控源文件夹中的图片文件，并将其上传到目标位置，同时归档到备份文件夹。

### 主要特性
- ✅ **自动上传**：实时监控源文件夹，自动上传新增图片
- ✅ **智能重试**：上传失败自动重试，确保文件安全传输
- ✅ **磁盘监控**：实时监控磁盘空间，防止空间不足
- ✅ **权限管理**：三级权限控制（访客/用户/管理员）
- ✅ **日志记录**：完整的操作日志，按日期自动归档
- ✅ **灵活配置**：支持多种文件格式、自定义上传间隔
- ✅ **快速启动**：目录模式打包，1-2秒即可启动

---

## 💻 系统要求

### 最低配置
- **操作系统**：Windows 10/11 (64位)
- **内存**：4GB RAM
- **硬盘空间**：1GB 可用空间
- **显示器**：1280x720 分辨率

### 推荐配置
- **操作系统**：Windows 10/11 (64位)
- **内存**：8GB RAM 或更高
- **硬盘空间**：2GB 可用空间
- **显示器**：1920x1080 分辨率

---

## 🚀 安装与启动

### 安装步骤
1. **解压文件**
   - 下载 `图片异步上传工具_v1.8.zip`
   - 解压到任意目录（如：`D:\图片异步上传工具_v1.8`）
   - ⚠️ **重要**：必须保持整个文件夹完整，不能只复制 .exe 文件

2. **文件结构**
   ```
   图片异步上传工具_v1.8\
   ├── 图片异步上传工具_v1.8.exe    # 主程序
   ├── config.json                   # 配置文件（首次运行自动生成）
   ├── logs\                         # 日志目录（自动创建）
   │   └── upload_YYYY-MM-DD.txt    # 日志文件
   └── _internal\                    # 程序依赖文件（不要修改）
       ├── assets\
       │   └── logo.png
       └── [其他依赖库...]
   ```

3. **启动程序**
   - 双击 `图片异步上传工具_v1.8.exe`
   - 程序将在 1-2 秒内启动

---

## 🖥️ 界面说明

### 主界面布局（三列布局）

```
┌─────────────────────────────────────────────────────────────┐
│ [Logo] 图片异步上传工具 v2 (PyQt)              [用户]      │
├─────────────┬─────────────┬─────────────────────────────────┤
│             │             │                                 │
│ 文件夹设置  │  操作控制   │        运行日志                │
│             │             │                                 │
│ 上传设置    │  运行状态   │   [日志内容区域]               │
│             │             │                                 │
│             │             │                                 │
└─────────────┴─────────────┴─────────────────────────────────┘
```

### 各区域功能

#### 1. 文件夹设置（左上）
- **源文件夹**：待上传图片所在的文件夹
- **目标文件夹**：图片上传的目标位置（可以是本地或网络路径）
- **备份文件夹**：上传成功后，原文件归档到此文件夹

#### 2. 上传设置（左下）
- **间隔时间(秒)**：每次上传之间的等待时间（默认30秒）
- **磁盘阈值(%)**：磁盘剩余空间低于此值时暂停上传（默认10%）
- **失败重试次数**：上传失败后的重试次数（默认3次）
- **磁盘检查间隔(秒)**：检查磁盘空间的频率（默认5秒）
- **文件类型限制**：选择需要上传的图片格式（JPG/PNG/BMP/TIFF/GIF/RAW）
- **高级选项**：
  - 🚩 开机自启动：Windows 启动时自动运行程序
  - 🏃 启动后自动运行：程序打开后自动开始上传

#### 3. 操作控制（中上）
- **▶ 开始上传**：开始监控和上传文件
- **⏸ 暂停上传**：暂停上传（保持监控）
- **⏹ 停止上传**：停止上传（停止监控）
- **💾 保存设置**：保存当前配置到 config.json
- **更多 ▼**：显示高级选项

#### 4. 运行状态（中下）
- **状态指示**：🟢 运行中 / 🟡 已暂停 / 🔴 已停止
- **统计信息**：
  - 已上传：成功上传的文件数
  - 失败：上传失败的文件数
  - 跳过：已存在而跳过的文件数
  - 速度：当前上传速度
- **磁盘空间**：
  - 目标磁盘：目标文件夹所在磁盘的剩余空间
  - 备份磁盘：备份文件夹所在磁盘的剩余空间
- **运行时间**：程序已运行时长（HH:MM:SS）
- **进度条**：当前上传批次的进度

#### 5. 运行日志（右侧）
- 显示所有操作记录和系统消息
- 支持自动滚动（可关闭）
- 日志同时保存到 `logs/upload_YYYY-MM-DD.txt` 文件

---

## ⚡ 快速开始

### 首次使用流程

1. **登录系统**
   - 点击右上角的 **[访客]** / **[用户]** 按钮
   - 首次使用建议以**管理员**身份登录
   - 默认管理员密码：`Tops123`
   - 默认用户密码：`123`

2. **配置文件夹路径**
   - 点击 **源文件夹** 的 **[浏览]** 按钮，选择待上传图片所在文件夹
   - 点击 **目标文件夹** 的 **[浏览]** 按钮，选择上传目标位置
   - 点击 **备份文件夹** 的 **[浏览]** 按钮，选择备份归档位置

3. **调整上传设置**（可选）
   - 根据需要调整间隔时间、磁盘阈值等参数
   - 选择需要上传的文件类型（默认仅上传 JPG）

4. **保存配置**
   - 点击 **💾 保存设置** 按钮
   - 配置将保存到 `config.json`，下次启动自动加载

5. **开始上传**
   - 点击 **▶ 开始上传** 按钮
   - 程序开始监控源文件夹，自动上传新增文件

6. **查看运行状态**
   - 在 **运行状态** 区域查看实时统计
   - 在 **运行日志** 区域查看详细操作记录

---

## 📚 功能详解

### 1. 文件上传机制

#### 上传流程
```
源文件夹 → 检测新文件 → 上传到目标 → 归档到备份 → 删除源文件
```

#### 详细说明
1. **文件检测**：每隔设定的间隔时间（默认30秒）扫描源文件夹
2. **格式过滤**：只上传选中的文件类型（如 JPG、PNG 等）
3. **上传处理**：
   - 检查目标文件是否已存在（存在则跳过）
   - 复制文件到目标文件夹
   - 验证文件完整性（通过文件大小）
4. **归档备份**：
   - 上传成功后，移动原文件到备份文件夹
   - 保持原有的文件名和扩展名
5. **错误处理**：
   - 上传失败自动重试（默认3次）
   - 重试失败后记录到失败日志（`failed_files.log`）

### 2. 磁盘空间监控

#### 监控机制
- 每隔设定的间隔（默认5秒）检查目标和备份磁盘的剩余空间
- 当剩余空间低于设定阈值（默认10%）时：
  - 🟡 自动暂停上传
  - ⚠️ 显示警告消息
  - 📝 记录到日志

#### 恢复机制
- 磁盘空间恢复到阈值以上时，自动恢复上传

### 3. 失败重试机制

#### 重试策略
- **首次失败**：等待 1 秒后重试
- **第二次失败**：等待 3 秒后重试
- **第三次失败**：等待 5 秒后重试
- **最终失败**：记录到 `failed_files.log`

#### 失败原因
- 网络连接中断
- 目标磁盘写入错误
- 文件被占用
- 权限不足

### 4. 日志系统

#### 日志文件
- **位置**：`logs/upload_YYYY-MM-DD.txt`
- **命名**：按日期自动创建（如 `upload_2025-10-22.txt`）
- **格式**：`[HH:MM:SS] 日志内容`

#### 日志内容
- 程序启动/停止
- 文件上传开始/成功/失败
- 磁盘空间警告
- 配置更改
- 错误信息

#### 日志示例
```
[16:20:15] 📖 正在加载配置文件...
[16:20:15] ✓ 配置文件加载成功
[16:20:30] 🚀 开始图片上传服务（上传与归档已分离）
[16:20:31] 📤 开始上传: image001.jpg
[16:20:32] ✓ 上传成功: image001.jpg
[16:20:35] 📦 已归档: image001.jpg
```

---

## 🔐 权限系统

### 三级权限

#### 1. 访客（Guest）
- **权限**：
  - ✅ 可以开始/暂停/停止上传
  - ✅ 可以查看运行状态和日志
  - ❌ 不能修改文件夹路径
  - ❌ 不能修改上传设置
  - ❌ 不能保存配置
- **适用场景**：临时使用、仅需上传功能

#### 2. 用户（User）
- **权限**：
  - ✅ 访客的所有权限
  - ✅ 可以修改上传设置（间隔、重试次数等）
  - ✅ 可以选择文件类型
  - ✅ 可以保存配置
  - ❌ 不能修改文件夹路径
  - ❌ 不能修改磁盘检查间隔
  - ❌ 不能修改密码
- **适用场景**：日常操作、调整参数
- **默认密码**：`123`

#### 3. 管理员（Admin）
- **权限**：
  - ✅ 用户的所有权限
  - ✅ 可以修改文件夹路径
  - ✅ 可以修改所有设置
  - ✅ 可以修改密码
  - ✅ 可以配置开机自启动
- **适用场景**：初始配置、系统管理
- **默认密码**：`Tops123`

### 登录/切换角色

1. **登录**
   - 点击右上角的角色按钮（如 **[访客]**）
   - 在弹出对话框中输入密码
   - 点击 **登录** 按钮

2. **注销**
   - 点击右上角的角色按钮（如 **[管理员]**）
   - 点击 **注销** 按钮

3. **修改密码**
   - 以管理员身份登录
   - 点击 **[管理员]** 按钮
   - 在对话框中输入新密码
   - 点击 **保存密码** 按钮

---

## 🔧 高级功能

### 1. 开机自启动

#### 启用方法
1. 以**管理员**身份登录
2. 勾选 **🚩 开机自启动**
3. 点击 **💾 保存设置**

#### 工作原理
- 程序会在 Windows 注册表中添加启动项
- 路径：`HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`
- 下次 Windows 启动时自动运行程序

#### 取消方法
- 取消勾选 **🚩 开机自启动**
- 点击 **💾 保存设置**

### 2. 启动后自动运行

#### 启用方法
1. 勾选 **🏃 启动后自动运行**
2. 点击 **💾 保存设置**

#### 工作原理
- 程序启动后 1 秒自动点击 **▶ 开始上传**
- 前提：必须已配置文件夹路径

### 3. 网络路径支持

#### 使用网络共享文件夹
- 目标文件夹支持 UNC 路径（如 `\\server\share\folder`）
- 确保有网络文件夹的读写权限
- 建议在局域网内使用，确保网络稳定

#### 示例
```
源文件夹：D:\工作\图片
目标文件夹：\\192.168.1.100\共享\上传
备份文件夹：D:\工作\备份
```

### 4. 配置文件管理

#### 配置文件位置
- 文件名：`config.json`
- 位置：程序 .exe 所在目录

#### 配置内容
```json
{
  "source_folder": "源文件夹路径",
  "target_folder": "目标文件夹路径",
  "backup_folder": "备份文件夹路径",
  "upload_interval": 30,
  "disk_threshold_percent": 10,
  "retry_count": 3,
  "disk_check_interval": 5,
  "filter_jpg": true,
  "filter_png": false,
  ...
}
```

#### 手动编辑
- 可以用文本编辑器打开 `config.json`
- 修改后重启程序生效
- ⚠️ 注意 JSON 格式的正确性

---

## ❓ 常见问题

### Q1: 程序启动后立即闪退？
**A:** 可能的原因：
- 缺少必要的依赖文件（检查 `_internal` 文件夹是否完整）
- 系统环境不兼容（确保是 Windows 10/11 64位系统）
- 被杀毒软件拦截（添加信任或关闭杀毒软件）

**解决方案**：
1. 重新解压完整的程序包
2. 以管理员身份运行
3. 检查杀毒软件日志

---

### Q2: 文件上传失败怎么办？
**A:** 检查项：
- 目标文件夹路径是否正确
- 是否有目标文件夹的写入权限
- 网络连接是否正常（如果是网络路径）
- 磁盘空间是否充足

**解决方案**：
1. 查看 **运行日志** 中的错误信息
2. 检查 `failed_files.log` 了解失败原因
3. 调整重试次数和间隔时间
4. 以管理员身份运行程序

---

### Q3: 日志文件没有生成？
**A:** 可能的原因：
- 程序没有创建 `logs` 目录的权限
- 磁盘空间不足

**解决方案**：
1. 以管理员身份运行程序
2. 手动在程序目录创建 `logs` 文件夹
3. 检查磁盘剩余空间

---

### Q4: 忘记管理员密码？
**A:** 解决方案：
1. 关闭程序
2. 删除 `config.json` 文件
3. 重新启动程序（将使用默认密码）
4. 默认密码：
   - 管理员：`Tops123`
   - 用户：`123`

---

### Q5: 如何卸载程序？
**A:** 步骤：
1. 停止正在运行的程序
2. 如果启用了开机自启动，先取消勾选并保存
3. 直接删除程序文件夹
4. （可选）删除注册表项：
   - 按 `Win+R`，输入 `regedit`
   - 导航到：`HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`
   - 删除 `图片异步上传工具` 项

---

### Q6: 程序占用内存过高？
**A:** 正常情况：
- 启动时：~100-150 MB
- 运行时：~150-200 MB
- 上传大量文件时可能增加到 300 MB

**异常情况**：
- 如果内存持续增长超过 500 MB，可能存在内存泄漏
- 建议：重启程序
- 联系技术支持

---

### Q7: 支持哪些图片格式？
**A:** 支持的格式：
- ✅ JPG / JPEG（最常用）
- ✅ PNG（透明背景图片）
- ✅ BMP（位图）
- ✅ TIFF / TIF（高质量图片）
- ✅ GIF（动图）
- ✅ RAW（相机原始格式）

可以在 **文件类型限制** 中勾选需要的格式。

---

## ⚠️ 注意事项

### 1. 文件安全
- ✅ **上传成功前不删除源文件**：只有确认上传成功且归档完成后才删除源文件
- ✅ **失败文件保留**：上传失败的文件会保留在源文件夹
- ✅ **备份归档**：所有成功上传的文件都会在备份文件夹保留副本
- ⚠️ **定期检查备份**：确保备份文件夹有足够空间

### 2. 磁盘空间
- ⚠️ **预留充足空间**：
  - 目标磁盘：建议预留至少 20% 空间
  - 备份磁盘：建议预留至少 30% 空间
- ⚠️ **及时清理**：定期清理备份文件夹的旧文件
- ✅ **自动保护**：低于阈值时自动暂停上传

### 3. 网络使用
- ⚠️ **局域网优先**：使用网络路径时优先选择局域网
- ⚠️ **网络稳定性**：确保网络连接稳定，避免频繁断线
- ✅ **自动重连**：网络临时中断会自动重试

### 4. 权限管理
- 🔐 **定期更改密码**：建议每 3 个月更改一次密码
- 🔐 **妥善保管密码**：遗失密码需要删除配置文件重置
- 🔐 **最小权限原则**：日常使用建议以用户权限登录

### 5. 性能优化
- ⚡ **适当调整间隔**：
  - 文件较多时增加间隔时间（如 60 秒）
  - 文件较少时可减少间隔时间（如 15 秒）
- ⚡ **文件类型过滤**：只选择需要上传的文件格式
- ⚡ **定期重启**：长期运行建议每周重启一次程序

### 6. 日志管理
- 📝 **定期查看日志**：通过日志了解程序运行状态
- 📝 **日志备份**：重要日志建议备份保存
- 📝 **日志清理**：旧日志文件可以手动删除（不影响程序运行）

---

## 📞 技术支持

### 联系方式
- **邮箱**：support@example.com
- **电话**：123-4567-8900
- **工作时间**：周一至周五 9:00-18:00

### 反馈问题时请提供
1. 程序版本号（如 v1.8）
2. 操作系统版本（如 Windows 11）
3. 问题详细描述
4. 错误截图
5. 日志文件（`logs/upload_YYYY-MM-DD.txt`）

---

## 📄 版本信息

**当前版本**：v1.8.1  
**发布日期**：2025年10月22日  
**更新内容**：
- ✨ 新增：每日自动创建日志文件功能
- ✨ 优化：三列布局，日志区域扩大 3 倍
- ✨ 优化：目录模式打包，启动速度提升 5-10 倍
- 🐛 修复：Logo 显示问题
- 🐛 修复：配置文件和日志文件路径问题
- 🐛 修复：复选框勾选标记显示问题

---

## 📜 版权声明

© 2025 图片异步上传工具. All rights reserved.

本软件受版权法保护，未经授权不得复制、修改或分发。

---

**祝您使用愉快！** 🎉
