# 打包说明 - 图片异步上传工具 v1.8

## ✅ 打包成功！

**打包日期**: 2025-10-22  
**打包工具**: PyInstaller 6.12.0  
**Python版本**: 3.13.5  
**Qt框架**: PySide6

---

## 📦 打包文件信息

| 项目 | 详情 |
|------|------|
| **文件名** | 图片异步上传工具_v1.8.exe |
| **文件大小** | 238.55 MB |
| **文件位置** | `e:\Python\文件上传\dist\` |
| **打包方式** | 单文件打包 (--onefile) |
| **窗口模式** | 无控制台窗口 (--windowed) |

---

## 📂 打包内容

### 主程序
- ✅ pyqt_app.py（主程序逻辑）
- ✅ PySide6 框架（完整 Qt 库）
- ✅ Python 3.13 运行时

### 资源文件
- ✅ config.json（配置文件模板）
- ✅ assets/logo.png（程序 Logo）
- ✅ assets/*.svg（UI 图标）
- ✅ logs/（日志目录）

### 依赖库
- ✅ PySide6.QtCore
- ✅ PySide6.QtGui
- ✅ PySide6.QtWidgets
- ✅ winreg（Windows 注册表）
- ✅ hashlib（密码加密）
- ✅ threading（多线程）
- ✅ queue（任务队列）

---

## 🚀 使用方法

### 1. 直接运行
双击 `图片异步上传工具_v1.8.exe` 即可启动程序

### 2. 首次运行
程序会自动在当前目录创建：
- `config.json` - 配置文件
- `logs/` - 日志目录
- `failed_files.log` - 失败文件记录（如有）

### 3. 推荐部署方式
```
推荐目录结构：
D:\ImageUploader\
├── 图片异步上传工具_v1.8.exe  （主程序）
├── config.json                （自动生成）
└── logs\                      （自动生成）
    ├── upload_YYYYMMDD.log
    └── failed_files.log
```

---

## 🔑 默认密码

| 角色 | 密码 |
|------|------|
| **用户** | 123 |
| **管理员** | Tops123 |

---

## ⚙️ 功能特性

### 未登录状态
- ✅ 可选择源文件夹
- ✅ 可查看所有配置（只读）
- ✅ 可执行上传任务
- ✅ 可暂停/恢复/停止上传
- ❌ 不能修改目标和备份路径
- ❌ 不能修改任何设置

### 登录后（用户/管理员）
- ✅ 可修改所有文件夹路径
- ✅ 可修改所有上传设置
- ✅ 可调整磁盘检查间隔（1-60秒）
- ✅ 可设置文件类型过滤
- ✅ 可保存配置
- ✅ 可设置开机自启动
- ✅ 可设置启动时自动运行

### 核心功能
- ✅ 异步文件上传
- ✅ 失败自动重试（递增等待：10s→30s→60s）
- ✅ 网络连接检测（每30秒）
- ✅ 独立归档线程
- ✅ 实时进度显示
- ✅ 磁盘空间监控（动态颜色警告）
- ✅ 详细日志记录
- ✅ 配置修改确认机制
- ✅ 路径验证和错误提示

---

## 📋 打包参数说明

### PyInstaller 命令
```bash
pyinstaller --clean --noconfirm \
  --onefile \                      # 单文件打包
  --windowed \                     # 无控制台窗口
  --name "图片异步上传工具_v1.8" \
  --add-data "config.json;." \     # 包含配置模板
  --add-data "assets;assets" \     # 包含资源文件
  --add-data "logs;logs" \         # 包含日志目录
  --hidden-import=PySide6.QtCore \ # 显式导入 Qt 模块
  --hidden-import=PySide6.QtGui \
  --hidden-import=PySide6.QtWidgets \
  --collect-all=PySide6 \          # 收集 PySide6 所有文件
  图片异步上传工具_v1.8.spec        # 使用 spec 文件
```

### Spec 文件配置
- **datas**: 包含配置文件和资源
- **hiddenimports**: 显式导入必要模块
- **excludes**: 排除不需要的库（如 PyQt5、tkinter）
- **console**: False（无控制台）
- **upx**: True（压缩可执行文件）

---

## ⚠️ 打包过程中的警告

### 可忽略的警告
```
WARNING: Library not found: fbclient.dll
WARNING: Library not found: MIMAPI64.dll  
WARNING: Library not found: OCI.dll
WARNING: Library not found: LIBPQ.dll
```
**说明**: 这些是 PySide6 SQL 驱动的可选依赖，本程序不使用数据库功能，可以忽略。

```
ERROR: Hidden import 'PyQt5.QtCore' not found
ERROR: Hidden import 'PyQt5.QtGui' not found
ERROR: Hidden import 'PyQt5.QtWidgets' not found
```
**说明**: 程序使用 PySide6，PyQt5 为备用方案，未安装不影响功能。

---

## 🧪 测试清单

打包后建议进行以下测试：

- [ ] 程序能正常启动
- [ ] Logo 正确显示
- [ ] 未登录状态权限正确
  - [ ] 源文件夹浏览可用
  - [ ] 目标/备份文件夹浏览禁用
  - [ ] 上传功能可用
- [ ] 登录功能正常
  - [ ] 用户密码验证
  - [ ] 管理员密码验证
- [ ] 登录后权限恢复
  - [ ] 所有浏览按钮可用
  - [ ] 所有设置项可用
- [ ] 上传功能测试
  - [ ] 路径验证正常
  - [ ] 配置修改确认对话框
  - [ ] 上传/暂停/停止正常
  - [ ] 进度显示正确
  - [ ] 日志输出清晰
- [ ] 磁盘空间监控
  - [ ] 目标磁盘空间显示
  - [ ] 归档磁盘空间显示
  - [ ] 可配置检查间隔
- [ ] 配置持久化
  - [ ] 保存配置成功
  - [ ] 重启后配置加载
- [ ] 开机自启动
  - [ ] 设置成功
  - [ ] 注册表正确写入

---

## 🐛 常见问题

### Q1: 程序无法启动
**可能原因**:
1. 缺少 VC++ 运行库
2. Windows Defender误报

**解决方法**:
1. 安装 Visual C++ Redistributable
2. 将exe添加到 Windows Defender 排除列表

### Q2: Logo 不显示
**原因**: assets 目录未正确打包

**解决**:
- 检查 `assets/logo.png` 是否存在
- 程序可正常运行，不影响功能

### Q3: 配置文件不保存
**原因**: 程序目录没有写入权限

**解决**:
- 不要放在 Program Files 目录
- 推荐放在用户文档目录或 D盘

### Q4: 文件大小很大（238 MB）
**原因**: 
- 包含完整的 PySide6 框架
- 包含 Python 运行时
- 未使用的 Qt 模块也被打包

**优化建议**:
- 使用 `--exclude-module` 排除不需要的模块
- 使用 UPX 进一步压缩（已启用）
- 权衡大小和兼容性

---

## 📊 打包性能数据

| 项目 | 数值 |
|------|------|
| 打包时间 | ~2-3 分钟 |
| 分析时间 | ~30 秒 |
| PKG 构建 | ~1 分钟 |
| EXE 构建 | ~1 分钟 |
| 最终大小 | 238.55 MB |

---

## 🔧 打包脚本优化

### v1.8 改进
1. **清晰的分步提示**：6个步骤清晰展示
2. **依赖检查增强**：自动检查 PySide6/PyQt5
3. **错误提示友好**：详细的错误原因和解决建议
4. **文件大小显示**：自动计算并显示 MB
5. **打包内容说明**：列出所有包含的内容
6. **使用提示完善**：密码、部署、注意事项

### 批处理脚本特性
- ✅ UTF-8 编码支持
- ✅ 自动环境检查
- ✅ 清理旧构建
- ✅ 进度提示清晰
- ✅ 错误处理完善
- ✅ 自动打开输出目录

---

## 📝 打包日志

### 成功标志
```
INFO: Building PKG (CArchive) 图片异步上传工具_v1.8.pkg completed
INFO: Building EXE from EXE-00.toc completed successfully
```

### 输出文件
- `dist/图片异步上传工具_v1.8.exe` - 可执行文件
- `build/图片异步上传工具_v1.8/` - 构建临时文件
- `图片异步上传工具_v1.8.spec` - 打包配置文件
- `build/图片异步上传工具_v1.8/warn-*.txt` - 警告日志
- `build/图片异步上传工具_v1.8/xref-*.html` - 依赖关系图

---

## 🚀 分发建议

### 单文件分发
直接分发 `图片异步上传工具_v1.8.exe`，无需其他文件

### 完整包分发
```
压缩包结构：
图片异步上传工具_v1.8.zip
├── 图片异步上传工具_v1.8.exe
├── README.txt（使用说明）
└── 更新日志_v1.8.md（可选）
```

### 系统要求
- **操作系统**: Windows 7 SP1 及以上
- **架构**: x64
- **运行库**: VC++ Redistributable（通常已安装）
- **权限**: 普通用户权限即可运行
- **磁盘空间**: 至少 300 MB 可用空间

---

## ✨ 下一步

1. **测试打包的 EXE**
   ```bash
   cd dist
   .\图片异步上传工具_v1.8.exe
   ```

2. **创建安装包** （可选）
   - 使用 Inno Setup 创建安装向导
   - 包含卸载功能
   - 自动创建桌面快捷方式

3. **数字签名** （推荐）
   - 避免 Windows SmartScreen 警告
   - 增加用户信任度

4. **版本管理**
   - 将 exe 文件归档
   - 标记 Git 版本标签

---

**打包完成时间**: 2025-10-22 15:37  
**打包状态**: ✅ 成功  
**输出位置**: `e:\Python\文件上传\dist\图片异步上传工具_v1.8.exe`  
**打包工具**: 打包程序.bat (v1.8)
