# 版本管理规范

## 📌 版本号格式

采用**语义化版本控制**（Semantic Versioning）规范：**X.Y.Z**

```
主版本号.次版本号.修订号
    X   .   Y   .  Z
```

---

## 🔢 版本号规则

### **X - 主版本号** (Major Version)
**何时升级**：重大架构变更或核心功能革新

**示例场景**：
- ✅ 新增FTP/SFTP等全新上传协议
- ✅ 完全重写界面框架（如从PyQt5迁移到PyQt6）
- ✅ 核心算法重构（如从单线程改为多线程）
- ✅ 不兼容的API变更

**升级规则**：`X+1, Y=0, Z=0`

**历史示例**：
- `1.9.0` → `2.0.0`: 新增FTP协议支持 + UI重构

---

### **Y - 次版本号** (Minor Version)
**何时升级**：新增重要功能模块或显著改进

**示例场景**：
- ✅ 新增磁盘自动清理功能
- ✅ 新增文件去重功能
- ✅ 新增网络监控功能
- ✅ 新增多语言支持
- ✅ 重要的性能优化（提升50%以上）

**升级规则**：`Y+1, Z=0`

**历史示例**：
- `2.0.0` → `2.1.0`: 新增磁盘清理 + 自动删除功能

---

### **Z - 修订号** (Patch Version)
**何时升级**：Bug修复、小功能优化、文档更新

**示例场景**：
- ✅ 修复已知Bug（崩溃、逻辑错误）
- ✅ 小功能增强（可选备份、UI微调）
- ✅ 性能小幅优化
- ✅ 界面文字调整
- ✅ 权限控制完善
- ✅ 日志输出优化
- ✅ 打包脚本改进
- ✅ 配置文件格式调整

**升级规则**：`Z+1`

**历史示例**：
- `2.1.0` → `2.1.1`: 新增可选备份功能
- `2.1.1` → `2.1.2`: 优化打包脚本输出目录

---

## 📋 版本发布流程

### 1. **代码修改**
完成功能开发或Bug修复

### 2. **更新版本号**
根据改动类型更新以下文件中的版本号：
- `pyqt_app.py` → `APP_VERSION` 和 `APP_TITLE`
- `scripts/打包程序.bat` → `VERSION` 变量
- 打包脚本标题注释

### 3. **提交代码**
```bash
# 小功能/Bug修复 (Z+1)
git commit -m "fix: 修复XXX问题 (v2.1.3)"
git commit -m "feat: 新增XXX小功能 (v2.1.3)"

# 重要功能 (Y+1)
git commit -m "feat: 新增XXX功能模块 (v2.2.0)"

# 重大更新 (X+1)
git commit -m "feat!: 重构XXX架构 (v3.0.0)"
```

### 4. **创建Git标签**
```bash
git tag -a v2.1.2 -m "v2.1.2: 优化打包脚本"
git push origin v2.1.2
```

### 5. **生成发布包**
运行打包脚本：
```bash
scripts\打包程序.bat
```
输出目录：`dist-{VERSION}/`

### 6. **编写更新日志**
在 `docs/` 目录创建 `v{VERSION}_更新说明.md`

---

## 📊 版本历史记录

| 版本号 | 发布日期 | 类型 | 主要内容 |
|--------|---------|------|---------|
| v1.9.0 | 2025-11-06 | 初始版本 | 图片异步上传基础功能 |
| v2.0.0 | 2025-11-10 | 重大更新 | 新增FTP协议 + UI可折叠优化 |
| v2.1.0 | 2025-11-13 | 功能更新 | 磁盘清理 + 自动删除功能 |
| v2.1.1 | 2025-11-17 | 功能优化 | 可选备份功能 |
| v2.1.2 | 2025-11-17 | 构建优化 | 打包脚本输出目录改进 |

---

## 🎯 版本命名建议

### ✅ 推荐的提交信息格式

```bash
# Bug修复
fix(core): 修复上传失败时崩溃问题 (v2.1.3)
fix(ui): 修复备份按钮状态不一致 (v2.1.3)

# 小功能
feat(ui): 新增文件拖拽上传功能 (v2.1.3)
feat(config): 支持导入导出配置文件 (v2.1.3)

# 重要功能
feat(protocol): 新增SFTP协议支持 (v2.2.0)
feat(security): 新增用户权限管理系统 (v2.2.0)

# 重大更新
feat!: 重构为多线程并发上传架构 (v3.0.0)
feat!: 迁移到Vue.js + Electron框架 (v3.0.0)

# 文档/构建
docs: 更新使用手册 (v2.1.2)
build: 优化打包流程 (v2.1.2)
chore: 更新依赖包版本 (v2.1.2)
```

---

## ⚠️ 注意事项

1. **向下兼容**：
   - Z版本更新必须保持API兼容
   - Y版本更新应尽量保持配置文件兼容
   - X版本更新可以破坏兼容性，但需在文档中明确说明

2. **版本号不回退**：
   - 已发布的版本号不可修改
   - 发现问题立即发布修复版本（Z+1）

3. **Git标签同步**：
   - 每个正式版本都应打Git标签
   - 标签名格式：`v{VERSION}`（如 v2.1.2）

4. **文档同步更新**：
   - 每次版本更新必须更新文档
   - 重要更新需编写独立的更新说明

---

## 🔗 参考资料

- [语义化版本控制规范](https://semver.org/lang/zh-CN/)
- [约定式提交规范](https://www.conventionalcommits.org/zh-hans/)
- [Git标签管理](https://git-scm.com/book/zh/v2/Git-基础-打标签)

---

**维护者**: RelMoTong  
**最后更新**: 2025-11-17
